<!DOCTYPE html>
<html lang="pt-br">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Cristiano Machado">
        <meta name="description" content="Este é um programa foi criado pra cadastro de pessoas.">

        <!-- PWA Meta Tags -->
        <meta name="theme-color" content="#3b82f6">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">
        <meta name="apple-mobile-web-app-title" content="Cadastro">

        <title>Sistema de Cadastro Pessoal</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="assets/css/style.css">
        <!-- PWA Manifest -->
        <link rel="manifest" href="/manifest.json">

        <!-- Apple Touch Icons -->
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180x180.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-32x32.png">

        <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
        
        <!-- Scripts de Segurança e Criptografia -->
        <script src="security/data-encryption.js"></script>
        <script src="security/encryption-integration.js"></script>
        
        <!-- Scripts de Auditoria -->
        <script src="security/audit-system.js"></script>
        <script src="security/audit-integration.js"></script>
        
        <!-- Scripts de Rate Limiting -->
        <script src="security/rate-limiting.js"></script>
        <script src="security/rate-limiting-integration.js"></script>
        
        <!-- Script de Correção ERR_BLOCKED_BY_CLIENT -->
        <script src="tools/firebase-blocked-client-fix.js"></script>
    </head>

    <body>

        <body class="bg-gray-50 min-h-screen">
            <div class="container mx-auto px-4 py-8">
                <!-- Header -->
                <header class="mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center">
                                <i class="fas fa-address-book text-blue-500 mr-3"></i> Sistema de Cadastro Pessoal
                            </h1>
                            <p class="text-gray-600 flex items-center">
                                <i class="fas fa-database mr-2 text-gray-400"></i> Gerencie seus registros de forma
                                simples
                                e eficiente
                            </p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- Informações do usuário logado (sempre visível) -->
                            <div id="userInfo" class="bg-blue-100 text-blue-800 px-4 py-2 rounded-lg flex items-center hidden">
                                <i class="fas fa-user mr-2"></i>
                                <div class="flex flex-col">
                                    <span id="userName" class="font-semibold text-sm">Carregando...</span>
                                    <span id="userRole" class="text-xs opacity-75">Verificando função...</span>
                                </div>
                            </div>
                            
                            <div class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-lg flex items-center">
                                <i class="fas fa-database mr-2"></i>
                                <span id="totalRecords" class="font-semibold mr-2">0</span> registros
                            </div>
                            <div class="bg-gray-100 text-gray-700 px-3 py-2 rounded-lg flex items-center">
                                <span id="connectionStatus" class="text-sm">
                                    <i class="fas fa-cloud-slash text-gray-500"></i> Conectando...
                                </span>
                            </div>
                            
                            <!-- Indicador de Sessão -->
                            <div id="sessionIndicator" class="bg-green-100 text-green-800 px-3 py-2 rounded-lg flex items-center hidden">
                                <span id="sessionStatus" class="text-sm">
                                    <i class="fas fa-clock text-green-500 mr-1"></i>
                                    <span id="sessionTime">30:00</span>
                                </span>
                            </div>

                            <!-- Menu Dropdown -->
                            <div class="relative" id="menuDropdown">
                                <button id="menuToggle" 
                                    class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md flex items-center transition-colors duration-200">
                                    <i class="fas fa-cog mr-2"></i> Menu
                                    <i class="fas fa-chevron-down ml-2 text-sm transition-transform duration-200" id="menuChevron"></i>
                                </button>
                                
                                <!-- Dropdown Content -->
                                <div id="menuContent" 
                                    class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200 z-50 hidden">
                                    <div class="py-1">
                                        <button id="exportBtn" 
                                            class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 flex items-center transition-colors duration-150">
                                            <i class="fas fa-file-export mr-3 text-green-600"></i> Exportar Dados
                                        </button>
                                        
                                        <label for="importInput" 
                                            class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 flex items-center cursor-pointer transition-colors duration-150">
                                            <i class="fas fa-file-import mr-3 text-blue-600"></i> Importar Dados
                                            <input type="file" id="importInput" accept=".json" class="hidden">
                                        </label>
                                        
                                        <div class="border-t border-gray-100 my-1"></div>
                                        
                                        <button id="extendSessionBtn" 
                                            class="w-full text-left px-4 py-2 text-green-700 hover:bg-green-50 flex items-center transition-colors duration-150 hidden">
                                            <i class="fas fa-clock mr-3 text-green-600"></i> Renovar Sessão
                                        </button>
                                        
                                        <button id="accessInfoBtn" 
                                            class="w-full text-left px-4 py-2 text-purple-700 hover:bg-purple-50 flex items-center transition-colors duration-150 hidden">
                                            <i class="fas fa-shield-alt mr-3 text-purple-600"></i> Informações de Acesso
                                        </button>
                                        
                                        <button id="logoutBtn" 
                                            class="w-full text-left px-4 py-2 text-red-700 hover:bg-red-50 flex items-center transition-colors duration-150 hidden">
                                            <i class="fas fa-sign-out-alt mr-3 text-red-600"></i> Sair do Sistema
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>




                <!-- Main Content - Two Columns -->
                <div class="flex flex-wrap responsive-columns -mx-2">
                    <!-- Coluna 1: Formulário de Cadastro -->
                    <div class="w-full md:w-1/2 px-2 mb-4">
                        <div class="bg-white rounded-lg custom-shadow p-6 h-full">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">
                                <i class="fas fa-user-plus mr-2 text-blue-500"></i>Formulário de Cadastro
                            </h2>

                            <form id="registrationForm" class="space-y-4">
                                <!-- Full Name -->
                                <div>
                                    <label for="fullName"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-user mr-2 text-blue-500"></i> Nome Completo *
                                    </label>
                                    <input type="text" id="fullName" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>

                                <!-- Origin Dropdown -->
                                <div>
                                    <label for="origin"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-map-marker-alt mr-2 text-blue-500"></i> Origem *
                                    </label>
                                    <select id="origin" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Selecione...</option>
                                        <option value="MSE">MSE</option>
                                        <option value="MP">MP</option>
                                        <option value="EP">EP</option>
                                        <option value="EPT">EPT</option>
                                    </select>
                                </div>

                                <!-- Date of Birth and Age -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="dob"
                                            class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                            <i class="fas fa-calendar-alt mr-2 text-blue-500"></i> Data de Nascimento *
                                        </label>
                                        <input type="date" id="dob" required
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="age"
                                            class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                            <i class="fas fa-birthday-cake mr-2 text-blue-500"></i> Idade
                                        </label>
                                        <input type="number" id="age" readonly
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
                                    </div>
                                </div>

                                <!-- City and Neighborhood -->
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="city"
                                            class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                            <i class="fas fa-city mr-2 text-blue-500"></i> Cidade *
                                        </label>
                                        <select id="city" required
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Selecione...</option>
                                            <option value="Rio de Janeiro">Rio de Janeiro</option>
                                            <option value="Angra dos Reis">Angra dos Reis</option>
                                            <option value="Aperibé">Aperibé</option>
                                            <option value="Araruama">Araruama</option>
                                            <option value="Areal">Areal</option>
                                            <option value="Armação dos Búzios">Armação dos Búzios</option>
                                            <option value="Arraial do Cabo">Arraial do Cabo</option>
                                            <option value="Barra do Piraí">Barra do Piraí</option>
                                            <option value="Barra Mansa">Barra Mansa</option>
                                            <option value="Belford Roxo">Belford Roxo</option>
                                            <option value="Bom Jardim">Bom Jardim</option>
                                            <option value="Bom Jesus do Itabapoana">Bom Jesus do Itabapoana</option>
                                            <option value="Cabo Frio">Cabo Frio</option>
                                            <option value="Cachoeiras de Macacu">Cachoeiras de Macacu</option>
                                            <option value="Cambuci">Cambuci</option>
                                            <option value="Campos dos Goytacazes">Campos dos Goytacazes</option>
                                            <option value="Cantagalo">Cantagalo</option>
                                            <option value="Carapebus">Carapebus</option>
                                            <option value="Cardoso Moreira">Cardoso Moreira</option>
                                            <option value="Carmo">Carmo</option>
                                            <option value="Casimiro de Abreu">Casimiro de Abreu</option>
                                            <option value="Comendador Levy Gasparian">Comendador Levy Gasparian</option>
                                            <option value="Conceição de Macabu">Conceição de Macabu</option>
                                            <option value="Cordeiro">Cordeiro</option>
                                            <option value="Duas Barras">Duas Barras</option>
                                            <option value="Duque de Caxias">Duque de Caxias</option>
                                            <option value="Engenheiro Paulo de Frontin">Engenheiro Paulo de Frontin
                                            </option>
                                            <option value="Guapimirim">Guapimirim</option>
                                            <option value="Iguaba Grande">Iguaba Grande</option>
                                            <option value="Itaboraí">Itaboraí</option>
                                            <option value="Itaguaí">Itaguaí</option>
                                            <option value="Italva">Italva</option>
                                            <option value="Itaocara">Itaocara</option>
                                            <option value="Itaperuna">Itaperuna</option>
                                            <option value="Itatiaia">Itatiaia</option>
                                            <option value="Japeri">Japeri</option>
                                            <option value="Laje do Muriaé">Laje do Muriaé</option>
                                            <option value="Macaé">Macaé</option>
                                            <option value="Macuco">Macuco</option>
                                            <option value="Magé">Magé</option>
                                            <option value="Mangaratiba">Mangaratiba</option>
                                            <option value="Maricá">Maricá</option>
                                            <option value="Mendes">Mendes</option>
                                            <option value="Mesquita">Mesquita</option>
                                            <option value="Miguel Pereira">Miguel Pereira</option>
                                            <option value="Miracema">Miracema</option>
                                            <option value="Natividade">Natividade</option>
                                            <option value="Nilópolis">Nilópolis</option>
                                            <option value="Niterói">Niterói</option>
                                            <option value="Nova Friburgo">Nova Friburgo</option>
                                            <option value="Nova Iguaçu">Nova Iguaçu</option>
                                            <option value="Paracambi">Paracambi</option>
                                            <option value="Paraíba do Sul">Paraíba do Sul</option>
                                            <option value="Paraty">Paraty</option>
                                            <option value="Paty do Alferes">Paty do Alferes</option>
                                            <option value="Petrópolis">Petrópolis</option>
                                            <option value="Pinheiral">Pinheiral</option>
                                            <option value="Piraí">Piraí</option>
                                            <option value="Porciúncula">Porciúncula</option>
                                            <option value="Porto Real">Porto Real</option>
                                            <option value="Quatis">Quatis</option>
                                            <option value="Queimados">Queimados</option>
                                            <option value="Quissamã">Quissamã</option>
                                            <option value="Resende">Resende</option>
                                            <option value="Rio Bonito">Rio Bonito</option>
                                            <option value="Rio Claro">Rio Claro</option>
                                            <option value="Rio das Flores">Rio das Flores</option>
                                            <option value="Rio das Ostras">Rio das Ostras</option>
                                            <option value="Santa Maria Madalena">Santa Maria Madalena</option>
                                            <option value="Santo Antônio de Pádua">Santo Antônio de Pádua</option>
                                            <option value="São Fidélis">São Fidélis</option>
                                            <option value="São Francisco de Itabapoana">São Francisco de Itabapoana
                                            </option>
                                            <option value="São Gonçalo">São Gonçalo</option>
                                            <option value="São João da Barra">São João da Barra</option>
                                            <option value="São João de Meriti">São João de Meriti</option>
                                            <option value="São José de Ubá">São José de Ubá</option>
                                            <option value="São José do Vale do Rio Preto">São José do Vale do Rio Preto
                                            </option>
                                            <option value="São Pedro da Aldeia">São Pedro da Aldeia</option>
                                            <option value="São Sebastião do Alto">São Sebastião do Alto</option>
                                            <option value="Sapucaia">Sapucaia</option>
                                            <option value="Saquarema">Saquarema</option>
                                            <option value="Seropédica">Seropédica</option>
                                            <option value="Silva Jardim">Silva Jardim</option>
                                            <option value="Sumidouro">Sumidouro</option>
                                            <option value="Tanguá">Tanguá</option>
                                            <option value="Teresópolis">Teresópolis</option>
                                            <option value="Trajano de Moraes">Trajano de Moraes</option>
                                            <option value="Três Rios">Três Rios</option>
                                            <option value="Valença">Valença</option>
                                            <option value="Varre-Sai">Varre-Sai</option>
                                            <option value="Vassouras">Vassouras</option>
                                            <option value="Volta Redonda">Volta Redonda</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="neighborhood"
                                            class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                            <i class="fas fa-map-marker mr-2 text-blue-500"></i> Bairro *
                                        </label>
                                        <select id="neighborhood" required
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Selecione a cidade primeiro</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Nível de Escolaridade -->
                                <div>
                                    <label for="education"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-graduation-cap mr-2 text-blue-500"></i> Escolaridade
                                    </label>
                                    <select id="education"
                                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2 border transition-all">
                                        <option value="">Selecione...</option>
                                        <optgroup label="Ensino Fundamental">
                                            <option value="1ª série EF">1ª série EF</option>
                                            <option value="2ª série EF">2ª série EF</option>
                                            <option value="3ª série EF">3ª série EF</option>
                                            <option value="4ª série EF">4ª série EF</option>
                                            <option value="5ª série EF">5ª série EF</option>
                                            <option value="6ª série EF">6ª série EF</option>
                                            <option value="7ª série EF">7ª série EF</option>
                                            <option value="8ª série EF">8ª série EF</option>
                                            <option value="9ª série EF">9ª série EF</option>
                                            <option value="Fundamental Completo">Fundamental Completo</option>
                                        </optgroup>
                                        <optgroup label="Ensino Médio">
                                            <option value="1º ano EM">1º ano EM</option>
                                            <option value="2º ano EM">2º ano EM</option>
                                            <option value="3º ano EM">3º ano EM</option>
                                            <option value="Médio Completo">Médio Completo</option>
                                        </optgroup>
                                    </select>
                                </div>

                                <!-- Status -->
                                <div>
                                    <label for="status"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-info-circle mr-2 text-blue-500"></i> Status
                                    </label>
                                    <select id="status"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="Em Análise">Em Análise</option>
                                        <option value="Contratado">Contratado</option>
                                        <option value="Não Contratado">Não Contratado</option>
                                    </select>
                                </div>

                                <!-- New Fields -->
                                <div>
                                    <label for="referenceName"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-user-friends mr-2 text-blue-500"></i> Nome da Referência
                                    </label>
                                    <input type="text" id="referenceName"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>

                                <div>
                                    <label for="forwarding"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-share-square mr-2 text-blue-500"></i> Encaminhamento
                                    </label>
                                    <input type="text" id="forwarding"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>

                                <div>
                                    <label for="observation"
                                        class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                        <i class="fas fa-sticky-note mr-2 text-blue-500"></i> Observação
                                    </label>
                                    <textarea id="observation" rows="3"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>

                                <!-- otões do Formulário -->
                                <div class="flex space-x-3 pt-4">
                                    <button type="submit"
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center justify-center">
                                        <i class="fas fa-save mr-2"></i> Salvar
                                    </button>
                                    <button type="button" id="clearFormBtn"
                                        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md flex items-center justify-center">
                                        <i class="fas fa-broom mr-2"></i> Limpar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Coluna 2: Busca e Registros com Aba de Estatísticas -->
                    <div class="w-full md:w-1/2 px-2 mb-4">
                        <div class="bg-white rounded-lg custom-shadow p-6 h-full">
                            <div class="flex border-b mb-4">
                                <button id="searchTabBtn" required
                                    class="flex-1 py-2 font-medium tab-active flex items-center justify-center">
                                    <i class="fas fa-search mr-2"></i> Busca
                                </button>
                                <button id="statsTabBtn"
                                    class="flex-1 py-2 font-medium text-gray-500 flex items-center justify-center">
                                    <i class="fas fa-chart-bar mr-2"></i> Estatísticas
                                </button>
                            </div>

                            <!-- Conteúdo de Busca -->
                            <div id="searchContent">
                                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                                    <i class="fas fa-search mr-2 text-green-500"></i>Busca de Registros
                                </h2>

                                <!-- Filtros de Busca -->
                                <div class="mb-6 space-y-4">
                                    <div>
                                        <label for="searchName"
                                            class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                            <i class="fas fa-user mr-2 text-green-500"></i> Nome
                                        </label>
                                        <div class="relative">
                                            <input type="text" id="searchName" placeholder="Buscar por nome"
                                                class="w-full pl-7 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="searchCity"
                                                class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                <i class="fas fa-city mr-2 text-green-500"></i> Cidade
                                            </label>
                                            <div class="relative">
                                                <select id="searchCity"
                                                    class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                    <option value="">Todas</option>
                                                    <option value="Rio de Janeiro">Rio de Janeiro</option>
                                                    <option value="Angra dos Reis">Angra dos Reis</option>
                                                    <option value="Aperibé">Aperibé</option>
                                                    <option value="Araruama">Araruama</option>
                                                    <option value="Areal">Areal</option>
                                                    <option value="Armação dos Búzios">Armação dos Búzios</option>
                                                    <option value="Arraial do Cabo">Arraial do Cabo</option>
                                                    <option value="Barra do Piraí">Barra do Piraí</option>
                                                    <option value="Barra Mansa">Barra Mansa</option>
                                                    <option value="Belford Roxo">Belford Roxo</option>
                                                    <option value="Bom Jardim">Bom Jardim</option>
                                                    <option value="Bom Jesus do Itabapoana">Bom Jesus do Itabapoana
                                                    </option>
                                                    <option value="Cabo Frio">Cabo Frio</option>
                                                    <option value="Cachoeiras de Macacu">Cachoeiras de Macacu</option>
                                                    <option value="Cambuci">Cambuci</option>
                                                    <option value="Campos dos Goytacazes">Campos dos Goytacazes</option>
                                                    <option value="Cantagalo">Cantagalo</option>
                                                    <option value="Carapebus">Carapebus</option>
                                                    <option value="Cardoso Moreira">Cardoso Moreira</option>
                                                    <option value="Carmo">Carmo</option>
                                                    <option value="Casimiro de Abreu">Casimiro de Abreu</option>
                                                    <option value="Comendador Levy Gasparian">Comendador Levy Gasparian
                                                    </option>
                                                    <option value="Conceição de Macabu">Conceição de Macabu</option>
                                                    <option value="Cordeiro">Cordeiro</option>
                                                    <option value="Duas Barras">Duas Barras</option>
                                                    <option value="Duque de Caxias">Duque de Caxias</option>
                                                    <option value="Engenheiro Paulo de Frontin">Engenheiro Paulo de
                                                        Frontin
                                                    </option>
                                                    <option value="Guapimirim">Guapimirim</option>
                                                    <option value="Iguaba Grande">Iguaba Grande</option>
                                                    <option value="Itaboraí">Itaboraí</option>
                                                    <option value="Itaguaí">Itaguaí</option>
                                                    <option value="Italva">Italva</option>
                                                    <option value="Itaocara">Itaocara</option>
                                                    <option value="Itaperuna">Itaperuna</option>
                                                    <option value="Itatiaia">Itatiaia</option>
                                                    <option value="Japeri">Japeri</option>
                                                    <option value="Laje do Muriaé">Laje do Muriaé</option>
                                                    <option value="Macaé">Macaé</option>
                                                    <option value="Macuco">Macuco</option>
                                                    <option value="Magé">Magé</option>
                                                    <option value="Mangaratiba">Mangaratiba</option>
                                                    <option value="Maricá">Maricá</option>
                                                    <option value="Mendes">Mendes</option>
                                                    <option value="Mesquita">Mesquita</option>
                                                    <option value="Miguel Pereira">Miguel Pereira</option>
                                                    <option value="Miracema">Miracema</option>
                                                    <option value="Natividade">Natividade</option>
                                                    <option value="Nilópolis">Nilópolis</option>
                                                    <option value="Niterói">Niterói</option>
                                                    <option value="Nova Friburgo">Nova Friburgo</option>
                                                    <option value="Nova Iguaçu">Nova Iguaçu</option>
                                                    <option value="Paracambi">Paracambi</option>
                                                    <option value="Paraíba do Sul">Paraíba do Sul</option>
                                                    <option value="Paraty">Paraty</option>
                                                    <option value="Paty do Alferes">Paty do Alferes</option>
                                                    <option value="Petrópolis">Petrópolis</option>
                                                    <option value="Pinheiral">Pinheiral</option>
                                                    <option value="Piraí">Piraí</option>
                                                    <option value="Porciúncula">Porciúncula</option>
                                                    <option value="Porto Real">Porto Real</option>
                                                    <option value="Quatis">Quatis</option>
                                                    <option value="Queimados">Queimados</option>
                                                    <option value="Quissamã">Quissamã</option>
                                                    <option value="Resende">Resende</option>
                                                    <option value="Rio Bonito">Rio Bonito</option>
                                                    <option value="Rio Claro">Rio Claro</option>
                                                    <option value="Rio das Flores">Rio das Flores</option>
                                                    <option value="Rio das Ostras">Rio das Ostras</option>
                                                    <option value="Santa Maria Madalena">Santa Maria Madalena</option>
                                                    <option value="Santo Antônio de Pádua">Santo Antônio de Pádua
                                                    </option>
                                                    <option value="São Fidélis">São Fidélis</option>
                                                    <option value="São Francisco de Itabapoana">São Francisco de
                                                        Itabapoana
                                                    </option>
                                                    <option value="São Gonçalo">São Gonçalo</option>
                                                    <option value="São João da Barra">São João da Barra</option>
                                                    <option value="São João de Meriti">São João de Meriti</option>
                                                    <option value="São José de Ubá">São José de Ubá</option>
                                                    <option value="São José do Vale do Rio Preto">São José do Vale do
                                                        Rio
                                                        Preto
                                                    </option>
                                                    <option value="São Pedro da Aldeia">São Pedro da Aldeia</option>
                                                    <option value="São Sebastião do Alto">São Sebastião do Alto</option>
                                                    <option value="Sapucaia">Sapucaia</option>
                                                    <option value="Saquarema">Saquarema</option>
                                                    <option value="Seropédica">Seropédica</option>
                                                    <option value="Silva Jardim">Silva Jardim</option>
                                                    <option value="Sumidouro">Sumidouro</option>
                                                    <option value="Tanguá">Tanguá</option>
                                                    <option value="Teresópolis">Teresópolis</option>
                                                    <option value="Trajano de Moraes">Trajano de Moraes</option>
                                                    <option value="Três Rios">Três Rios</option>
                                                    <option value="Valença">Valença</option>
                                                    <option value="Varre-Sai">Varre-Sai</option>
                                                    <option value="Vassouras">Vassouras</option>
                                                    <option value="Volta Redonda">Volta Redonda</option>
                                                </select>
                                                <div class="absolute left-3 top-2.5 text-gray-400">

                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label for="searchNeighborhood"
                                                class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                <i class="fas fa-map-marker-alt mr-2 text-green-500"></i> Bairro
                                            </label>
                                            <div class="relative">
                                                <select id="searchNeighborhood"
                                                    class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                    <option value="">Todos</option>
                                                </select>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="searchOrigin"
                                                class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                <i class="fas fa-map-pin mr-2 text-green-500"></i> Origem
                                            </label>
                                            <div class="relative">
                                                <select id="searchOrigin"
                                                    class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                    <option value="">Todas</option>
                                                    <option value="MSE">MSE</option>
                                                    <option value="MP">MP</option>
                                                    <option value="EP">EP</option>
                                                    <option value="EPT">EPT</option>
                                                </select>

                                            </div>
                                        </div>
                                        <div>
                                            <label for="searchStatus"
                                                class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                <i class="fas fa-info-circle mr-2 text-green-500"></i> Status
                                            </label>
                                            <div class="relative">
                                                <select id="searchStatus"
                                                    class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                    <option value="">Todos</option>
                                                    <option value="Em Análise">Em Análise</option>
                                                    <option value="Contratado">Contratado</option>
                                                    <option value="Não Contratado">Não Contratado</option>
                                                </select>
                                            </div>

                                        </div>
                                        <div>
                                            <label for="searchEducation"
                                                class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                <i class="fas fa-graduation-cap mr-2 text-green-500"></i> Escolaridade
                                            </label>
                                            <select id="searchEducation"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                <option value="">Todas</option>
                                                <optgroup label="Ensino Fundamental">
                                                    <option value="1ª série EF">1ª série EF</option>
                                                    <option value="2ª série EF">2ª série EF</option>
                                                    <option value="3ª série EF">3ª série EF</option>
                                                    <option value="4ª série EF">4ª série EF</option>
                                                    <option value="5ª série EF">5ª série EF</option>
                                                    <option value="6ª série EF">6ª série EF</option>
                                                    <option value="7ª série EF">7ª série EF</option>
                                                    <option value="8ª série EF">8ªescola série EF</option>
                                                    <option value="9ª série EF">9ª série EF</option>
                                                    <option value="Fundamental Completo">Fundamental Completo</option>
                                                </optgroup>
                                                <optgroup label="Ensino Médio">
                                                    <option value="1º ano EM">1º ano EM</option>
                                                    <option value="2º ano EM">2º ano EM</option>
                                                    <option value="3º ano EM">3º ano EM</option>
                                                    <option value="Médio Completo">Médio Completo</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                        <!-- Dentro da div com classe "mb-6 space-y-4" na seção de busca -->
                                        <div class="grid grid-cols-2 gap-4">
                                            <!-- Filtro por Ano -->
                                            <div>
                                                <label for="searchYear"
                                                    class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                    <i class="fas fa-calendar mr-2 text-green-500"></i> Ano de Cadastro
                                                </label>
                                                <select id="searchYear"
                                                    class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                    <option value="">Todos</option>
                                                </select>
                                            </div>

                                            <!-- Filtro por Encaminhamento -->
                                            <div>
                                                <label for="searchForwarding"
                                                    class="block text-sm font-medium text-gray-700 mb-1 flex items-center">
                                                    <i class="fas fa-share-square mr-2 text-green-500"></i>
                                                    Encaminhamento
                                                </label>
                                                <select id="searchForwarding"
                                                    class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                                    <option value="">Todos</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-center w-full">
                                        <button id="searchBtn"
                                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center flex-grow justify-center">
                                            <i class="fas fa-search mr-2"></i> Buscar
                                        </button>
                                        <button id="clearSearchBtn"
                                            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md flex items-center flex-grow justify-center">
                                            <i class="fas fa-broom mr-2"></i> Limpar
                                        </button>
                                    </div>

                                </div>

                                <!-- Tabela de Registros-->
                                <div class="overflow-x-auto">
                                    <table class="w-full records-table">
                                        <thead>
                                            <tr class="text-left text-sm text-gray-600 uppercase">
                                                <th class="py-3 px-4">Nome</th>
                                                <th class="py-3 px-4">Município</th>
                                                <th class="py-3 px-4">Status</th>
                                                <th class="py-3 px-4">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recordsTableBody" class="text-sm text-gray-700">
                                            <!-- Linhas serão inseridas dinamicamente pelo JavaScript -->
                                        </tbody>
                                    </table>

                                    <!-- Paginação -->
                                    <div id="pagination" class="pagination mt-6 mb-4 hidden">
                                        <ul class="flex items-center">
                                            <li class="page-item disabled" id="prevPage">
                                                <a class="page-link" href="#" tabindex="-1">
                                                    <i class="fas fa-chevron-left"></i>
                                                </a>
                                            </li>
                                            <li class="page-item active">
                                                <a class="page-link" href="#">1</a>
                                            </li>
                                            <li class="page-item" id="nextPage">
                                                <a class="page-link" href="#">
                                                    <i class="fas fa-chevron-right"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Conteúdo de Estatísticas (Oculto por padrão) -->
                            <div id="statsContent" class="hidden">
                                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                                    <i class="fas fa-chart-pie mr-2 text-purple-500"></i>Estatísticas
                                </h2>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <!-- Cartão de Total de Registros -->
                                    <div
                                        class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500 hover:shadow-md transition-shadow">
                                        <div class="flex items-center">
                                            <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                                                <i class="fas fa-users text-xl"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-500">Total de Registros</p>
                                                <p class="text-2xl font-bold" id="statsTotalRecords">0</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Average Age Card -->
                                    <div
                                        class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500 hover:shadow-md transition-shadow">
                                        <div class="flex items-center">
                                            <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                                                <i class="fas fa-birthday-cake text-xl"></i>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-500">Idade Média</p>
                                                <p class="text-2xl font-bold" id="statsAvgAge">0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <!-- Card por Status -->
                                    <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
                                        <h3
                                            class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                                            <i class="fas fa-chart-pie mr-2 text-purple-500"></i> Por Status
                                        </h3>
                                        <div id="statsByStatus" class="space-y-2">
                                            <div class="text-center text-gray-500 py-4">
                                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                                <p>Nenhum dado disponível</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Card por Origem -->
                                    <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
                                        <h3
                                            class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                                            <i class="fas fa-map-marker-alt mr-2 text-blue-500"></i> Por Origem
                                        </h3>
                                        <div id="statsByOrigin" class="space-y-2">
                                            <div class="text-center text-gray-500 py-4">
                                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                                <p>Nenhum dado disponível</p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <!-- Card por Cidade -->
                                    <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
                                        <h3
                                            class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                                            <i class="fas fa-city mr-2 text-green-500"></i> Por Cidade
                                        </h3>
                                        <div id="statsByCity" class="space-y-2">
                                            <div class="text-center text-gray-500 py-4">
                                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                                <p>Nenhum dado disponível</p>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Card Por Escolaridade -->
                                    <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
                                        <h3
                                            class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                                            <i class="fas fa-graduation-cap mr-2 text-blue-500"></i> Por Escolaridade
                                        </h3>
                                        <div id="statsByEducation" class="space-y-2">
                                            <div class="text-center text-gray-500 py-4">
                                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                                <p>Nenhum dado disponível</p>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <!-- Estatísticas por Ano -->
                                    <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
                                        <h3
                                            class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                                            <i class="fas fa-calendar-alt mr-2 text-purple-500"></i> Por Ano de Cadastro
                                        </h3>
                                        <div id="statsByYear" class="space-y-2">
                                            <div class="text-center text-gray-500 py-4">
                                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                                <p>Nenhum dado disponível</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Estatísticas por Encaminhamento -->
                                    <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
                                        <h3
                                            class="text-sm font-medium text-gray-500 uppercase tracking-wider mb-3 flex items-center">
                                            <i class="fas fa-share-square mr-2 text-blue-500"></i> Por Encaminhamento
                                        </h3>
                                        <div id="statsByForwarding" class="space-y-2">
                                            <div class="text-center text-gray-500 py-4">
                                                <i class="fas fa-chart-bar text-2xl mb-1"></i>
                                                <p>Nenhum dado disponível</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--  Modal de Detalhes do Registro -->
            <div id="recordModal"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal">
                <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl modal-content relative">
                    <!-- Botão de fechar -->
                    <button class="close-modal" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                    </button>

                    <div class="p-6 print-content">
                        <div class="print-header">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                        <i class="fas fa-user-circle text-blue-500 mr-2"></i> Detalhes do Registro
                                    </h3>
                                    <p class="text-sm text-gray-500">Sistema de Cadastro Pessoal</p>
                                </div>
                                <div class="text-sm text-gray-500 mr-7">
                                    <p>Data: <span id="printDate"></span></p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <!-- Nome Completo -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Nome Completo</div>
                                    <div id="modalFullName" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Origem -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Origem</div>
                                    <div id="modalOrigin" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Data de Nascimento -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Data de Nascimento</div>
                                    <div id="modalDob" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Idade -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-birthday-cake"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Idade</div>
                                    <div id="modalAge" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Cidade -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-city"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Cidade</div>
                                    <div id="modalCity" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Bairro -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-map-marker"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Bairro</div>
                                    <div id="modalNeighborhood" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Escolaridade -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Escolaridade</div>
                                    <div id="modalEducation" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Status -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Status</div>
                                    <div id="modalStatus" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Nome da Referência -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Nome da Referência</div>
                                    <div id="modalReferenceName" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Encaminhamento -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-share-square"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Encaminhamento</div>
                                    <div id="modalForwarding" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Observação -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-sticky-note"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Observação</div>
                                    <div id="modalObservation" class="detail-value">-</div>
                                </div>
                            </div>

                            <!-- Data de Cadastro -->
                            <div class="detail-item">
                                <div class="detail-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <div class="detail-content">
                                    <div class="detail-label">Data de Cadastro</div>
                                    <div id="modalCreatedAt" class="detail-value">-</div>
                                </div>
                            </div>
                        </div>

                        <div class="border-t pt-4 flex justify-end space-x-3 ">
                            <button onclick="printRecord()"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md flex items-center no-print">
                                <i class="fas fa-print mr-2"></i> Imprimir
                            </button>
                            <button onclick="enableEditMode()" id="editBtn"
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center">
                                <i class="fas fa-edit mr-2"></i> Editar
                            </button>
                            <button onclick="saveChanges()" id="saveBtn"
                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center hidden">
                                <i class="fas fa-save mr-2"></i> Salvar
                            </button>
                            <button onclick="deleteRecord()"
                                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md flex items-center">
                                <i class="fas fa-trash mr-2"></i> Excluir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </body>
        <script src="assets/js/app.js"></script>
        <!-- <script src="config/dev.config.js"></script> -->
        <!-- PWA Scripts -->
        <script src="/pwa-installer.js"></script>
        
        <!-- Script de Autenticação -->
        <script type="module">
            // Importar Firebase completo
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { 
                getAuth, 
                onAuthStateChanged,
                signOut,
                signInWithEmailAndPassword
            } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
            import {
                getFirestore,
                collection,
                addDoc,
                getDocs,
                doc,
                updateDoc,
                deleteDoc,
                query,
                orderBy,
                onSnapshot,
                serverTimestamp
            } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

            // Importar configuração segura
            import { firebaseConfig, configManager } from "./config/firebase-secure.config.js";
            
            // Importar sistema RBAC
            import { accessControl, PERMISSIONS, ROLES } from "./config/rbac-config.js";

            // Verificar se a configuração foi carregada corretamente
            if (!firebaseConfig.apiKey) {
                console.error('❌ Configuração Firebase não encontrada!');
                console.log('💡 Verifique as variáveis de ambiente ou configure localmente');
                
                // Mostrar mensagem de erro na interface
                document.body.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center bg-red-50">
                        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md text-center">
                            <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                            <h2 class="text-xl font-bold text-red-800 mb-2">Erro de Configuração</h2>
                            <p class="text-red-600 mb-4">
                                As configurações do Firebase não foram encontradas.
                            </p>
                            <p class="text-sm text-gray-600">
                                Verifique as variáveis de ambiente ou entre em contato com o administrador.
                            </p>
                        </div>
                    </div>
                `;
                throw new Error('Configuração Firebase não encontrada');
            }

            // Inicializar Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            // Criar serviço Firebase simplificado
            class SimpleFirebaseService {
                constructor() {
                    this.db = db;
                    this.auth = auth;
                    this.isConnected = false;
                    this.currentUser = null;
                    
                    console.log('🔥 Firebase Service inicializado');
                    this.testConnection();
                }
                
                async testConnection() {
                    try {
                        // Testar conexão básica
                        await getDocs(query(collection(this.db, 'records')));
                        this.isConnected = true;
                        console.log('✅ Firebase conectado com sucesso');
                        this.updateConnectionStatus('online');
                    } catch (error) {
                        console.log('❌ Erro na conexão Firebase:', error.message);
                        this.isConnected = false;
                        this.updateConnectionStatus('offline');
                    }
                }
                
                updateConnectionStatus(status) {
                    const statusElement = document.getElementById('connectionStatus');
                    if (statusElement) {
                        if (status === 'online') {
                            statusElement.innerHTML = '<i class="fas fa-cloud text-green-500"></i> Online';
                            statusElement.className = 'text-sm text-green-600';
                        } else {
                            statusElement.innerHTML = '<i class="fas fa-cloud-slash text-red-500"></i> Offline';
                            statusElement.className = 'text-sm text-red-600';
                        }
                    }
                }
                
                async loadRecords() {
                    try {
                        const q = query(collection(this.db, 'records'), orderBy('createdAt', 'desc'));
                        const querySnapshot = await getDocs(q);
                        const records = [];
                        
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            records.push({
                                ...data,
                                firebaseId: doc.id,
                                createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt
                            });
                        });
                        
                        console.log(`☁️ ${records.length} registros carregados do Firebase`);
                        return records;
                    } catch (error) {
                        console.error('❌ Erro ao carregar registros:', error);
                        return [];
                    }
                }
                
                async saveRecord(record) {
                    try {
                        const docRef = await addDoc(collection(this.db, 'records'), {
                            ...record,
                            createdAt: serverTimestamp(),
                            updatedAt: serverTimestamp()
                        });
                        
                        console.log('✅ Registro salvo no Firebase:', docRef.id);
                        return docRef.id;
                    } catch (error) {
                        console.error('❌ Erro ao salvar registro:', error);
                        throw error;
                    }
                }
                
                setupRealtimeSync() {
                    if (!this.isConnected) return;
                    
                    try {
                        const q = query(collection(this.db, 'records'), orderBy('createdAt', 'desc'));
                        return onSnapshot(q, (querySnapshot) => {
                            const records = [];
                            querySnapshot.forEach((doc) => {
                                const data = doc.data();
                                records.push({
                                    ...data,
                                    firebaseId: doc.id,
                                    createdAt: data.createdAt?.toDate?.()?.toISOString() || data.createdAt
                                });
                            });
                            
                            // Atualizar dados globais se disponível
                            if (typeof appData !== 'undefined') {
                                appData.records = records;
                                if (typeof updateUI === 'function') {
                                    updateUI();
                                }
                            }
                            
                            console.log('🔄 Dados sincronizados em tempo real');
                        });
                    } catch (error) {
                        console.error('❌ Erro na sincronização em tempo real:', error);
                    }
                }
            }
            
            // Criar instância global do serviço
            window.firebaseService = new SimpleFirebaseService();
            
            // Disponibilizar Firebase globalmente para debug
            window.firebase = { app, auth, db };
            window.firebaseConfig = firebaseConfig;

            // Elementos DOM
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');
            const logoutBtn = document.getElementById('logoutBtn');
            const extendSessionBtn = document.getElementById('extendSessionBtn');
            const sessionIndicator = document.getElementById('sessionIndicator');
            const sessionTime = document.getElementById('sessionTime');

            // Verificar estado de autenticação
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // Usuário está logado
                    console.log('✅ Usuário autenticado:', user.email);
                    
                    // Configurar controle de acesso
                    accessControl.setCurrentUser(user);
                    const userInfo_data = accessControl.getCurrentUserInfo();
                    
                    if (!userInfo_data || userInfo_data.roles.length === 0) {
                        // Usuário sem funções definidas
                        console.error('❌ Usuário sem permissões definidas:', user.email);
                        showAccessDeniedPage();
                        return;
                    }
                    
                    // Mostrar informações do usuário
                    userName.textContent = user.email;
                    
                    // Mostrar funções do usuário
                    const roleNames = userInfo_data.roles.map(role => role.displayName).join(', ');
                    const roleIcons = userInfo_data.roles.map(role => `<i class="fas ${role.icon} mr-1"></i>`).join('');
                    userRole.innerHTML = `${roleIcons}${roleNames}`;
                    
                    // Aplicar cor baseada na função principal
                    const primaryRole = userInfo_data.roles[0];
                    const colorClass = {
                        red: 'bg-red-100 text-red-800',
                        blue: 'bg-blue-100 text-blue-800',
                        green: 'bg-green-100 text-green-800',
                        purple: 'bg-purple-100 text-purple-800',
                        yellow: 'bg-yellow-100 text-yellow-800'
                    }[primaryRole.color] || 'bg-blue-100 text-blue-800';
                    
                    userInfo.className = `${colorClass} px-4 py-2 rounded-lg flex items-center`;
                    
                    // Mostrar elementos da interface
                    userInfo.classList.remove('hidden');
                    logoutBtn.classList.remove('hidden');
                    
                    // Mostrar botão de renovar sessão apenas se tiver permissão
                    if (accessControl.hasPermission(PERMISSIONS.EXTEND_SESSION)) {
                        extendSessionBtn.classList.remove('hidden');
                    }
                    
                    // Mostrar informações de acesso apenas para administradores
                    if (accessControl.hasPermission(PERMISSIONS.VIEW_AUDIT_LOG)) {
                        document.getElementById('accessInfoBtn').classList.remove('hidden');
                    }
                    
                    sessionIndicator.classList.remove('hidden');
                    
                    // Configurar interface baseada em permissões
                    setupPermissionBasedUI();
                    
                    // Disponibilizar globalmente para outros scripts
                    window.currentUser = user;
                    window.userPermissions = userInfo_data;
                    
                } else {
                    // Usuário não está logado - redirecionar para login
                    console.log('❌ Usuário não autenticado - redirecionando...');
                    accessControl.clearCurrentUser();
                    window.location.href = 'components/login.html';
                }
            });

            // Função para mostrar página de acesso negado
            function showAccessDeniedPage() {
                document.body.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center bg-red-50">
                        <div class="bg-white p-8 rounded-lg shadow-lg max-w-md text-center">
                            <i class="fas fa-ban text-red-500 text-6xl mb-6"></i>
                            <h2 class="text-2xl font-bold text-red-800 mb-4">Acesso Negado</h2>
                            <p class="text-red-600 mb-4">
                                Você não possui permissões para acessar este sistema.
                            </p>
                            <p class="text-sm text-gray-600 mb-6">
                                Entre em contato com o administrador para solicitar acesso.
                            </p>
                            <button onclick="handleLogout()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                <i class="fas fa-sign-out-alt mr-2"></i>
                                Sair do Sistema
                            </button>
                        </div>
                    </div>
                `;
            }

            // Função para configurar interface baseada em permissões
            function setupPermissionBasedUI() {
                // Botões de ação no formulário
                const saveBtn = document.querySelector('button[type="submit"]');
                const clearBtn = document.getElementById('clearFormBtn');
                
                // Botões de exportação/importação
                const exportBtn = document.getElementById('exportBtn');
                const importInput = document.getElementById('importInput');
                
                // Verificar permissões e habilitar/desabilitar elementos
                
                // Criar registros
                if (!accessControl.hasPermission(PERMISSIONS.CREATE_RECORD)) {
                    if (saveBtn) {
                        saveBtn.disabled = true;
                        saveBtn.innerHTML = '<i class="fas fa-ban mr-2"></i>Sem Permissão';
                        saveBtn.className = saveBtn.className.replace('bg-blue-600', 'bg-gray-400');
                    }
                }
                
                // Exportar dados
                if (!accessControl.hasPermission(PERMISSIONS.EXPORT_DATA)) {
                    if (exportBtn) {
                        exportBtn.style.display = 'none';
                    }
                }
                
                // Importar dados
                if (!accessControl.hasPermission(PERMISSIONS.IMPORT_DATA)) {
                    const importLabel = document.querySelector('label[for="importInput"]');
                    if (importLabel) {
                        importLabel.style.display = 'none';
                    }
                }
                
                // Adicionar indicadores visuais de permissões
                addPermissionIndicators();
            }

            // Função para adicionar indicadores visuais de permissões
            function addPermissionIndicators() {
                const userInfo_data = accessControl.getCurrentUserInfo();
                if (!userInfo_data) return;
                
                // Criar tooltip com permissões
                const tooltip = document.createElement('div');
                tooltip.className = 'hidden absolute bg-gray-800 text-white text-xs rounded py-2 px-3 z-50 max-w-xs';
                tooltip.innerHTML = `
                    <div class="font-semibold mb-2">Suas Permissões:</div>
                    <ul class="text-xs space-y-1">
                        ${userInfo_data.permissions.map(permission => `
                            <li><i class="fas fa-check text-green-400 mr-1"></i>${permission.replace('_', ' ')}</li>
                        `).join('')}
                    </ul>
                `;
                
                document.body.appendChild(tooltip);
                
                // Adicionar evento de hover no userInfo
                userInfo.addEventListener('mouseenter', (e) => {
                    tooltip.style.left = e.pageX + 'px';
                    tooltip.style.top = (e.pageY + 20) + 'px';
                    tooltip.classList.remove('hidden');
                });
                
                userInfo.addEventListener('mouseleave', () => {
                    tooltip.classList.add('hidden');
                });
            }

            // Função de logout
            async function handleLogout() {
                try {
                    await signOut(auth);
                    console.log('✅ Logout realizado com sucesso');
                    
                    // Limpar controle de acesso
                    accessControl.clearCurrentUser();
                    
                    // Redirecionar para login
                    window.location.href = 'components/login.html';
                    
                } catch (error) {
                    console.error('❌ Erro no logout:', error);
                    alert('Erro ao fazer logout. Tente novamente.');
                }
            }

            // Disponibilizar função globalmente
            window.handleLogout = handleLogout;

            // Event listener para o botão de logout
            logoutBtn.addEventListener('click', () => {
                if (confirm('Tem certeza que deseja sair do sistema?')) {
                    handleLogout();
                }
            });

            // Event listener para renovar sessão
            extendSessionBtn.addEventListener('click', () => {
                if (accessControl.hasPermission(PERMISSIONS.EXTEND_SESSION)) {
                    if (window.sessionManager) {
                        window.sessionManager.extendSession();
                    }
                } else {
                    accessControl.showAccessDeniedMessage('Você não tem permissão para renovar a sessão');
                }
            });

            // ==============================================
            // PROTEÇÃO DE OPERAÇÕES COM RBAC
            // ==============================================

            // Interceptar operações de CRUD quando o app.js carregar
            document.addEventListener('DOMContentLoaded', function() {
                // Aguardar carregamento completo
                setTimeout(() => {
                    setupCRUDProtection();
                }, 2000);
            });

            function setupCRUDProtection() {
                // Proteger formulário de cadastro
                const registrationForm = document.getElementById('registrationForm');
                if (registrationForm) {
                    registrationForm.addEventListener('submit', function(e) {
                        if (!accessControl.hasPermission(PERMISSIONS.CREATE_RECORD)) {
                            e.preventDefault();
                            accessControl.showAccessDeniedMessage('Você não tem permissão para criar registros');
                            return false;
                        }
                    });
                }

                // Proteger botão de exportação
                const exportBtn = document.getElementById('exportBtn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', function(e) {
                        if (!accessControl.hasPermission(PERMISSIONS.EXPORT_DATA)) {
                            e.preventDefault();
                            accessControl.showAccessDeniedMessage('Você não tem permissão para exportar dados');
                            return false;
                        }
                    });
                }

                // Proteger importação
                const importInput = document.getElementById('importInput');
                if (importInput) {
                    importInput.addEventListener('change', function(e) {
                        if (!accessControl.hasPermission(PERMISSIONS.IMPORT_DATA)) {
                            e.preventDefault();
                            this.value = '';
                            accessControl.showAccessDeniedMessage('Você não tem permissão para importar dados');
                            return false;
                        }
                    });
                }

                // Interceptar funções globais se existirem
                if (typeof window.editRecord === 'function') {
                    const originalEditRecord = window.editRecord;
                    window.editRecord = function(recordId) {
                        if (accessControl.hasPermission(PERMISSIONS.UPDATE_RECORD)) {
                            return originalEditRecord(recordId);
                        } else {
                            accessControl.showAccessDeniedMessage('Você não tem permissão para editar registros');
                        }
                    };
                }

                if (typeof window.deleteRecord === 'function') {
                    const originalDeleteRecord = window.deleteRecord;
                    window.deleteRecord = function(recordId) {
                        if (accessControl.hasPermission(PERMISSIONS.DELETE_RECORD)) {
                            return originalDeleteRecord(recordId);
                        } else {
                            accessControl.showAccessDeniedMessage('Você não tem permissão para excluir registros');
                        }
                    };
                }

                console.log('🔒 Proteção RBAC aplicada às operações CRUD');
            }

            // Event listener para informações de acesso
            document.addEventListener('DOMContentLoaded', function() {
                const accessInfoBtn = document.getElementById('accessInfoBtn');
                if (accessInfoBtn) {
                    accessInfoBtn.addEventListener('click', () => {
                        showAccessInfoModal();
                    });
                }
            });

            // Função para mostrar modal com informações de acesso
            function showAccessInfoModal() {
                if (!accessControl.hasPermission(PERMISSIONS.VIEW_AUDIT_LOG)) {
                    accessControl.showAccessDeniedMessage('Você não tem permissão para visualizar informações de acesso');
                    return;
                }

                const userInfo_data = accessControl.getCurrentUserInfo();
                const auditLog = accessControl.getAuditLog(20);
                const stats = accessControl.getAccessStats();

                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">
                                    <i class="fas fa-shield-alt text-purple-600 mr-2"></i>
                                    Informações de Acesso
                                </h2>
                                <button id="closeAccessModal" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>

                            <!-- Informações do Usuário Atual -->
                            <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                                <h3 class="font-semibold text-blue-800 mb-3">Usuário Atual</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p><strong>Email:</strong> ${userInfo_data.email}</p>
                                        <p><strong>UID:</strong> ${userInfo_data.uid}</p>
                                        <p><strong>Admin:</strong> ${userInfo_data.isAdmin ? 'Sim' : 'Não'}</p>
                                    </div>
                                    <div>
                                        <p><strong>Funções:</strong></p>
                                        <div class="mt-1">
                                            ${userInfo_data.roles.map(role => `
                                                <span class="inline-block bg-${role.color}-100 text-${role.color}-800 px-2 py-1 rounded text-xs mr-1 mb-1">
                                                    <i class="fas ${role.icon} mr-1"></i>${role.displayName}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Estatísticas -->
                            <div class="mb-6 p-4 bg-green-50 rounded-lg">
                                <h3 class="font-semibold text-green-800 mb-3">Estatísticas de Acesso</h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                    <div>
                                        <div class="text-2xl font-bold text-green-600">${stats.totalLogs}</div>
                                        <div class="text-sm text-gray-600">Total de Logs</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-blue-600">${stats.uniqueUsers}</div>
                                        <div class="text-sm text-gray-600">Usuários Únicos</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-purple-600">${stats.loginCount}</div>
                                        <div class="text-sm text-gray-600">Logins</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-red-600">${stats.deniedCount}</div>
                                        <div class="text-sm text-gray-600">Acessos Negados</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Permissões -->
                            <div class="mb-6 p-4 bg-yellow-50 rounded-lg">
                                <h3 class="font-semibold text-yellow-800 mb-3">Suas Permissões</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                                    ${userInfo_data.permissions.map(permission => `
                                        <div class="flex items-center text-sm">
                                            <i class="fas fa-check text-green-500 mr-2"></i>
                                            <span>${permission.replace(/_/g, ' ').toLowerCase()}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Log de Auditoria -->
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <h3 class="font-semibold text-gray-800 mb-3">Log de Auditoria (Últimas 20 ações)</h3>
                                <div class="max-h-64 overflow-y-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-100 sticky top-0">
                                            <tr>
                                                <th class="text-left p-2">Horário</th>
                                                <th class="text-left p-2">Usuário</th>
                                                <th class="text-left p-2">Ação</th>
                                                <th class="text-left p-2">Detalhes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${auditLog.map(log => `
                                                <tr class="border-b">
                                                    <td class="p-2">${new Date(log.timestamp).toLocaleString()}</td>
                                                    <td class="p-2">${log.user}</td>
                                                    <td class="p-2">
                                                        <span class="px-2 py-1 rounded text-xs ${
                                                            log.action === 'ACCESS_DENIED' ? 'bg-red-100 text-red-800' :
                                                            log.action === 'USER_LOGIN' ? 'bg-green-100 text-green-800' :
                                                            'bg-blue-100 text-blue-800'
                                                        }">
                                                            ${log.action}
                                                        </span>
                                                    </td>
                                                    <td class="p-2 text-xs text-gray-600">${log.details}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Event listener para fechar modal
                modal.querySelector('#closeAccessModal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });

                // Fechar ao clicar fora
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            // Disponibilizar função globalmente
            window.handleLogout = handleLogout;

            // ==============================================
            // CONTROLE DE SESSÃO E TIMEOUT
            // ==============================================

            class SessionManager {
                constructor() {
                    // Configurações de timeout (em milissegundos)
                    this.sessionTimeout = 30 * 60 * 1000; // 30 minutos
                    this.warningTime = 5 * 60 * 1000; // 5 minutos antes do timeout
                    this.checkInterval = 60 * 1000; // Verificar a cada 1 minuto
                    
                    // Variáveis de controle
                    this.lastActivity = Date.now();
                    this.warningShown = false;
                    this.timeoutTimer = null;
                    this.checkTimer = null;
                    this.warningModal = null;
                    
                    this.init();
                }

                init() {
                    // Iniciar monitoramento apenas se usuário estiver logado
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            this.startMonitoring();
                            console.log('🕐 Controle de sessão iniciado - Timeout: 30 minutos');
                        } else {
                            this.stopMonitoring();
                        }
                    });
                }

                startMonitoring() {
                    // Resetar atividade
                    this.updateActivity();
                    
                    // Eventos que indicam atividade do usuário
                    const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
                    
                    events.forEach(event => {
                        document.addEventListener(event, () => this.updateActivity(), true);
                    });

                    // Iniciar verificação periódica
                    this.checkTimer = setInterval(() => {
                        this.checkSession();
                        this.updateSessionIndicator();
                    }, this.checkInterval);

                    // Atualizar indicador imediatamente
                    this.updateSessionIndicator();

                    console.log('👀 Monitoramento de atividade iniciado');
                }

                stopMonitoring() {
                    if (this.checkTimer) {
                        clearInterval(this.checkTimer);
                        this.checkTimer = null;
                    }
                    
                    if (this.timeoutTimer) {
                        clearTimeout(this.timeoutTimer);
                        this.timeoutTimer = null;
                    }

                    this.hideWarning();
                    console.log('⏹️ Monitoramento de sessão parado');
                }

                updateActivity() {
                    this.lastActivity = Date.now();
                    this.warningShown = false;
                    
                    // Esconder aviso se estiver sendo mostrado
                    if (this.warningModal) {
                        this.hideWarning();
                    }

                    // Cancelar timeout se existir
                    if (this.timeoutTimer) {
                        clearTimeout(this.timeoutTimer);
                        this.timeoutTimer = null;
                    }
                }

                checkSession() {
                    const now = Date.now();
                    const timeSinceActivity = now - this.lastActivity;
                    const timeUntilTimeout = this.sessionTimeout - timeSinceActivity;

                    // Se passou do tempo limite, fazer logout
                    if (timeSinceActivity >= this.sessionTimeout) {
                        this.forceLogout('Sessão expirada por inatividade');
                        return;
                    }

                    // Se está próximo do timeout e ainda não mostrou aviso
                    if (timeUntilTimeout <= this.warningTime && !this.warningShown) {
                        this.showWarning(Math.ceil(timeUntilTimeout / 1000));
                    }
                }

                showWarning(secondsLeft) {
                    this.warningShown = true;
                    
                    // Criar modal de aviso
                    this.warningModal = document.createElement('div');
                    this.warningModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    this.warningModal.innerHTML = `
                        <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">Sessão Expirando</h3>
                                <p class="text-gray-600 mb-4">
                                    Sua sessão expirará em <span id="countdown" class="font-bold text-red-600">${Math.ceil(secondsLeft)}</span> segundos por inatividade.
                                </p>
                                <div class="flex space-x-3">
                                    <button id="extendSession" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-clock mr-2"></i>
                                        Continuar Sessão
                                    </button>
                                    <button id="logoutNow" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors">
                                        <i class="fas fa-sign-out-alt mr-2"></i>
                                        Sair Agora
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(this.warningModal);

                    // Countdown timer
                    const countdownElement = this.warningModal.querySelector('#countdown');
                    let timeLeft = secondsLeft;
                    
                    const countdownTimer = setInterval(() => {
                        timeLeft--;
                        if (countdownElement) {
                            countdownElement.textContent = Math.max(0, timeLeft);
                        }
                        
                        if (timeLeft <= 0) {
                            clearInterval(countdownTimer);
                            this.forceLogout('Sessão expirada por inatividade');
                        }
                    }, 1000);

                    // Event listeners
                    this.warningModal.querySelector('#extendSession').addEventListener('click', () => {
                        clearInterval(countdownTimer);
                        this.updateActivity();
                        this.hideWarning();
                        this.showToast('Sessão renovada com sucesso!', 'success');
                    });

                    this.warningModal.querySelector('#logoutNow').addEventListener('click', () => {
                        clearInterval(countdownTimer);
                        this.forceLogout('Logout solicitado pelo usuário');
                    });

                    // Programar logout automático
                    this.timeoutTimer = setTimeout(() => {
                        clearInterval(countdownTimer);
                        this.forceLogout('Sessão expirada por inatividade');
                    }, secondsLeft * 1000);

                    console.log(`⚠️ Aviso de sessão mostrado - ${secondsLeft}s restantes`);
                }

                hideWarning() {
                    if (this.warningModal) {
                        document.body.removeChild(this.warningModal);
                        this.warningModal = null;
                        this.warningShown = false;
                    }
                }

                async forceLogout(reason) {
                    console.log(`🔒 Logout forçado: ${reason}`);
                    
                    this.stopMonitoring();
                    this.hideWarning();
                    
                    // Mostrar mensagem de logout
                    this.showToast(reason, 'warning');
                    
                    try {
                        await signOut(auth);
                        
                        // Aguardar um pouco antes de redirecionar
                        setTimeout(() => {
                            window.location.href = 'components/login.html';
                        }, 2000);
                        
                    } catch (error) {
                        console.error('❌ Erro no logout forçado:', error);
                        // Redirecionar mesmo com erro
                        window.location.href = 'components/login.html';
                    }
                }

                showToast(message, type = 'info') {
                    const toast = document.createElement('div');
                    const colors = {
                        success: 'bg-green-500',
                        warning: 'bg-yellow-500',
                        error: 'bg-red-500',
                        info: 'bg-blue-500'
                    };
                    
                    toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300`;
                    toast.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.body.appendChild(toast);
                    
                    // Remover após 3 segundos
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 3000);
                }

                // Método para estender sessão manualmente
                extendSession() {
                    this.updateActivity();
                    this.showToast('Sessão renovada manualmente', 'success');
                    console.log('🔄 Sessão estendida manualmente');
                }

                // Obter tempo restante da sessão
                getTimeRemaining() {
                    const timeSinceActivity = Date.now() - this.lastActivity;
                    const timeRemaining = this.sessionTimeout - timeSinceActivity;
                    return Math.max(0, timeRemaining);
                }

                // Obter status da sessão
                getSessionStatus() {
                    const timeRemaining = this.getTimeRemaining();
                    const minutes = Math.floor(timeRemaining / (1000 * 60));
                    const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
                    
                    return {
                        timeRemaining,
                        minutes,
                        seconds,
                        isActive: timeRemaining > 0,
                        isWarning: timeRemaining <= this.warningTime
                    };
                }

                // Método para atualizar indicador visual
                updateSessionIndicator() {
                    const sessionTimeElement = document.getElementById('sessionTime');
                    const sessionIndicatorElement = document.getElementById('sessionIndicator');
                    
                    if (!sessionTimeElement || !sessionIndicatorElement) return;
                    
                    const status = this.getSessionStatus();
                    const minutes = Math.floor(status.minutes);
                    const seconds = Math.floor(status.seconds);
                    
                    // Formatar tempo
                    const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Alterar cor baseado no tempo restante
                    if (status.isWarning) {
                        // Menos de 5 minutos - vermelho
                        sessionIndicatorElement.className = 'bg-red-100 text-red-800 px-3 py-2 rounded-lg flex items-center';
                        sessionTimeElement.innerHTML = `<i class="fas fa-exclamation-triangle text-red-500 mr-1"></i>${timeString}`;
                    } else if (status.minutes < 10) {
                        // Menos de 10 minutos - amarelo
                        sessionIndicatorElement.className = 'bg-yellow-100 text-yellow-800 px-3 py-2 rounded-lg flex items-center';
                        sessionTimeElement.innerHTML = `<i class="fas fa-clock text-yellow-500 mr-1"></i>${timeString}`;
                    } else {
                        // Mais de 10 minutos - verde
                        sessionIndicatorElement.className = 'bg-green-100 text-green-800 px-3 py-2 rounded-lg flex items-center';
                        sessionTimeElement.innerHTML = `<i class="fas fa-clock text-green-500 mr-1"></i>${timeString}`;
                    }
                }
            }

            // Inicializar gerenciador de sessão
            const sessionManager = new SessionManager();

            // Disponibilizar globalmente para debug
            window.sessionManager = sessionManager;

            // Comandos úteis para debug (disponíveis no console)
            window.sessionDebug = {
                // Ver status atual da sessão
                status: () => {
                    const status = sessionManager.getSessionStatus();
                    console.log('📊 Status da Sessão:', {
                        tempoRestante: `${status.minutes}:${status.seconds.toString().padStart(2, '0')}`,
                        ativo: status.isActive,
                        aviso: status.isWarning,
                        ultimaAtividade: new Date(sessionManager.lastActivity).toLocaleTimeString()
                    });
                    return status;
                },
                
                // Estender sessão
                extend: () => {
                    sessionManager.extendSession();
                    console.log('✅ Sessão estendida');
                },
                
                // Forçar logout (para teste)
                forceLogout: () => {
                    sessionManager.forceLogout('Logout forçado via console');
                },
                
                // Simular inatividade (para teste)
                simulateInactivity: (minutes = 25) => {
                    sessionManager.lastActivity = Date.now() - (minutes * 60 * 1000);
                    console.log(`⏰ Simulando ${minutes} minutos de inatividade`);
                }
            };

            console.log('🔐 Sistema de controle de sessão carregado');
            console.log('💡 Use sessionDebug.status() para ver status da sessão');
            console.log('💡 Use sessionDebug.extend() para renovar sessão');
            console.log('💡 Use sessionDebug.simulateInactivity(25) para testar timeout');
            
            // Controle do Menu Dropdown
            const menuToggle = document.getElementById('menuToggle');
            const menuContent = document.getElementById('menuContent');
            const menuChevron = document.getElementById('menuChevron');
            
            // Toggle do menu
            menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = !menuContent.classList.contains('hidden');
                
                if (isOpen) {
                    // Fechar menu
                    menuContent.classList.add('hidden');
                    menuChevron.style.transform = 'rotate(0deg)';
                } else {
                    // Abrir menu
                    menuContent.classList.remove('hidden');
                    menuChevron.style.transform = 'rotate(180deg)';
                }
            });
            
            // Fechar menu ao clicar fora
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !menuContent.contains(e.target)) {
                    menuContent.classList.add('hidden');
                    menuChevron.style.transform = 'rotate(0deg)';
                }
            });
            
            // Fechar menu ao clicar em uma opção
            menuContent.addEventListener('click', () => {
                menuContent.classList.add('hidden');
                menuChevron.style.transform = 'rotate(0deg)';
            });
            
            console.log('🔐 Sistema de autenticação carregado');
            console.log('⚙️ Menu dropdown configurado');
        </script>


</html>