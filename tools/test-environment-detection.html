<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Detec√ß√£o Autom√°tica de Ambiente</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #4facfe;
            background: #f8f9fa;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #4facfe;
        }

        .info-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-card p {
            color: #666;
            line-height: 1.6;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-error { background: #dc3545; }
        .status-info { background: #17a2b8; }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .log-container {
            background: #1e1e1e;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }

        .log-info { background: rgba(23, 162, 184, 0.2); }
        .log-success { background: rgba(40, 167, 69, 0.2); }
        .log-warning { background: rgba(255, 193, 7, 0.2); }
        .log-error { background: rgba(220, 53, 69, 0.2); }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .content {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Detec√ß√£o Autom√°tica de Ambiente</h1>
            <p>Sistema avan√ßado de detec√ß√£o e configura√ß√£o de ambiente</p>
        </div>

        <div class="content">
            <!-- Informa√ß√µes do Ambiente -->
            <div class="section">
                <h2>üìä Informa√ß√µes do Ambiente</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>üåç Ambiente Detectado</h3>
                        <p id="environment-type">Carregando...</p>
                    </div>
                    <div class="info-card">
                        <h3>üîí Status de Seguran√ßa</h3>
                        <p id="security-status">Carregando...</p>
                    </div>
                    <div class="info-card">
                        <h3>üåê Informa√ß√µes de Rede</h3>
                        <p id="network-info">Carregando...</p>
                    </div>
                    <div class="info-card">
                        <h3>üíª Contexto de Execu√ß√£o</h3>
                        <p id="execution-context">Carregando...</p>
                    </div>
                </div>
            </div>

            <!-- Recursos Dispon√≠veis -->
            <div class="section">
                <h2>‚ö° Recursos Dispon√≠veis</h2>
                <div class="feature-list" id="features-list">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>

            <!-- Configura√ß√µes Recomendadas -->
            <div class="section">
                <h2>‚öôÔ∏è Configura√ß√µes Recomendadas</h2>
                <div class="info-card">
                    <div id="recommended-config">Carregando...</div>
                </div>
            </div>

            <!-- Testes e A√ß√µes -->
            <div class="section">
                <h2>üß™ Testes e A√ß√µes</h2>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="testEnvironmentDetection()">üîç Testar Detec√ß√£o</button>
                    <button class="btn btn-secondary" onclick="checkAllFeatures()">‚ö° Verificar Recursos</button>
                    <button class="btn btn-success" onclick="testFirebaseConfig()">üî• Testar Firebase</button>
                    <button class="btn btn-warning" onclick="simulateProduction()">üöÄ Simular Produ√ß√£o</button>
                    <button class="btn btn-primary" onclick="reloadEnvironment()">üîÑ Recarregar</button>
                    <button class="btn btn-secondary" onclick="clearLogs()">üßπ Limpar Logs</button>
                </div>
            </div>

            <!-- Console de Logs -->
            <div class="section">
                <h2>üìù Console de Logs</h2>
                <div class="log-container" id="log-container">
                    <div class="log-entry log-info">Sistema iniciado. Aguardando testes...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        // Importar os m√≥dulos necess√°rios
        import { environmentDetector } from '../config/environment-detector.js';
        import { firebaseConfig, configManager } from '../config/firebase-secure.config.js';

        // Vari√°veis globais
        let logContainer;
        let environmentInfo;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('log-container');
            initializeEnvironmentInfo();
            updateUI();
            
            // Interceptar console para mostrar logs
            interceptConsole();
            
            addLog('‚úÖ Sistema de detec√ß√£o de ambiente carregado', 'success');
        });

        /**
         * Inicializa as informa√ß√µes do ambiente
         */
        function initializeEnvironmentInfo() {
            try {
                environmentInfo = environmentDetector.getEnvironmentInfo();
                addLog(`üîç Ambiente detectado: ${environmentInfo.type}`, 'info');
            } catch (error) {
                addLog(`‚ùå Erro ao detectar ambiente: ${error.message}`, 'error');
                console.error('Erro na detec√ß√£o de ambiente:', error);
            }
        }

        /**
         * Atualiza a interface com as informa√ß√µes do ambiente
         */
        function updateUI() {
            if (!environmentInfo) {
                addLog('‚ö†Ô∏è Informa√ß√µes do ambiente n√£o dispon√≠veis', 'warning');
                return;
            }

            // Atualizar informa√ß√µes b√°sicas
            updateEnvironmentType();
            updateSecurityStatus();
            updateNetworkInfo();
            updateExecutionContext();
            updateFeaturesList();
            updateRecommendedConfig();
        }

        /**
         * Atualiza o tipo de ambiente
         */
        function updateEnvironmentType() {
            const element = document.getElementById('environment-type');
            const { type, isProduction } = environmentInfo;
            const emoji = getEnvironmentEmoji(type);
            
            element.innerHTML = `
                <span class="status-indicator ${isProduction ? 'status-error' : 'status-success'}"></span>
                ${emoji} ${type.toUpperCase()}
                ${isProduction ? '<br><small>üöÄ Ambiente de Produ√ß√£o</small>' : '<br><small>üõ†Ô∏è Ambiente de Desenvolvimento</small>'}
            `;
        }

        /**
         * Atualiza o status de seguran√ßa
         */
        function updateSecurityStatus() {
            const element = document.getElementById('security-status');
            const { isSecure, availableFeatures, type } = environmentInfo;
            
            let status = 'success';
            let message = 'üîí Seguro';
            
            if (type === 'insecure-production') {
                status = 'error';
                message = 'üö® Produ√ß√£o Insegura';
            } else if (!isSecure) {
                status = 'warning';
                message = '‚ö†Ô∏è N√£o Seguro (HTTP)';
            } else if (!availableFeatures.secureContext) {
                status = 'warning';
                message = '‚ö†Ô∏è Contexto Inseguro';
            }
            
            element.innerHTML = `
                <span class="status-indicator status-${status}"></span>
                ${message}
                <br><small>HTTPS: ${isSecure ? '‚úÖ' : '‚ùå'} | Contexto Seguro: ${availableFeatures.secureContext ? '‚úÖ' : '‚ùå'}</small>
            `;
        }

        /**
         * Atualiza informa√ß√µes de rede
         */
        function updateNetworkInfo() {
            const element = document.getElementById('network-info');
            const { protocol, hostname, port } = environmentInfo;
            
            element.innerHTML = `
                <strong>Protocolo:</strong> ${protocol}<br>
                <strong>Host:</strong> ${hostname}<br>
                <strong>Porta:</strong> ${port || 'Padr√£o'}
            `;
        }

        /**
         * Atualiza contexto de execu√ß√£o
         */
        function updateExecutionContext() {
            const element = document.getElementById('execution-context');
            const { executionContext } = environmentInfo;
            
            const contexts = [];
            if (executionContext.isPWA) contexts.push('üì± PWA');
            if (executionContext.isElectron) contexts.push('‚ö° Electron');
            if (executionContext.isMobile) contexts.push('üì± Mobile');
            if (executionContext.isTablet) contexts.push('üì± Tablet');
            if (executionContext.isDesktop) contexts.push('üíª Desktop');
            
            element.innerHTML = `
                <strong>Plataforma:</strong> ${contexts.join(', ') || 'üíª Web'}<br>
                <strong>Navegador:</strong> ${executionContext.browser}<br>
                <strong>SO:</strong> ${executionContext.os}
            `;
        }

        /**
         * Atualiza lista de recursos
         */
        function updateFeaturesList() {
            const container = document.getElementById('features-list');
            const { availableFeatures } = environmentInfo;
            
            container.innerHTML = '';
            
            Object.entries(availableFeatures).forEach(([feature, available]) => {
                const featureElement = document.createElement('div');
                featureElement.className = 'feature-item';
                featureElement.innerHTML = `
                    <span class="status-indicator ${available ? 'status-success' : 'status-error'}"></span>
                    ${getFeatureName(feature)}
                `;
                container.appendChild(featureElement);
            });
        }

        /**
         * Atualiza configura√ß√µes recomendadas
         */
        function updateRecommendedConfig() {
            const element = document.getElementById('recommended-config');
            const { recommendedConfig } = environmentInfo;
            
            const configHtml = Object.entries(recommendedConfig)
                .map(([key, value]) => `<strong>${getConfigName(key)}:</strong> ${value}`)
                .join('<br>');
            
            element.innerHTML = configHtml;
        }

        /**
         * Obt√©m emoji do ambiente
         */
        function getEnvironmentEmoji(type) {
            const emojis = {
                production: 'üöÄ',
                staging: 'üé≠',
                development: 'üõ†Ô∏è',
                test: 'üß™',
                'local-file': 'üìÅ',
                'insecure-production': 'üö®'
            };
            return emojis[type] || '‚ùì';
        }

        /**
         * Obt√©m nome amig√°vel do recurso
         */
        function getFeatureName(feature) {
            const names = {
                serviceWorker: 'Service Worker',
                pushNotifications: 'Push Notifications',
                geolocation: 'Geolocaliza√ß√£o',
                camera: 'C√¢mera',
                offlineStorage: 'Armazenamento Offline',
                indexedDB: 'IndexedDB',
                crypto: 'Web Crypto API',
                secureContext: 'Contexto Seguro',
                onlineStatus: 'Status Online',
                connection: 'Network Information',
                performanceAPI: 'Performance API',
                webWorkers: 'Web Workers'
            };
            return names[feature] || feature;
        }

        /**
         * Obt√©m nome amig√°vel da configura√ß√£o
         */
        function getConfigName(config) {
            const names = {
                debugMode: 'Modo Debug',
                logging: 'N√≠vel de Log',
                caching: 'Cache',
                minification: 'Minifica√ß√£o',
                securityLevel: 'N√≠vel de Seguran√ßa',
                analytics: 'Analytics'
            };
            return names[config] || config;
        }

        /**
         * Intercepta console para mostrar logs na interface
         */
        function interceptConsole() {
            const originalLog = console.log;
            const originalWarn = console.warn;
            const originalError = console.error;
            const originalInfo = console.info;

            console.log = function(...args) {
                originalLog.apply(console, args);
                addLog(args.join(' '), 'info');
            };

            console.warn = function(...args) {
                originalWarn.apply(console, args);
                addLog(args.join(' '), 'warning');
            };

            console.error = function(...args) {
                originalError.apply(console, args);
                addLog(args.join(' '), 'error');
            };

            console.info = function(...args) {
                originalInfo.apply(console, args);
                addLog(args.join(' '), 'info');
            };
        }

        /**
         * Adiciona log √† interface
         */
        function addLog(message, type = 'info') {
            if (!logContainer) return;
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Fun√ß√µes globais para os bot√µes
        window.testEnvironmentDetection = function() {
            addLog('üîç Iniciando teste de detec√ß√£o de ambiente...', 'info');
            
            try {
                // Recarregar informa√ß√µes
                environmentInfo = environmentDetector.getEnvironmentInfo();
                updateUI();
                
                // Mostrar informa√ß√µes detalhadas
                console.table({
                    'Tipo de Ambiente': environmentInfo.type,
                    '√â Produ√ß√£o': environmentInfo.isProduction,
                    '√â Seguro (HTTPS)': environmentInfo.isSecure,
                    '√â PWA': environmentInfo.executionContext.isPWA,
                    'Navegador': environmentInfo.executionContext.browser,
                    'Sistema Operacional': environmentInfo.executionContext.os
                });
                
                addLog('‚úÖ Teste de detec√ß√£o conclu√≠do com sucesso', 'success');
            } catch (error) {
                addLog(`‚ùå Erro no teste: ${error.message}`, 'error');
            }
        };

        window.checkAllFeatures = function() {
            addLog('‚ö° Verificando todos os recursos dispon√≠veis...', 'info');
            
            const features = environmentInfo.availableFeatures;
            let availableCount = 0;
            let totalCount = 0;
            
            Object.entries(features).forEach(([feature, available]) => {
                totalCount++;
                if (available) availableCount++;
                
                const status = available ? '‚úÖ' : '‚ùå';
                addLog(`${status} ${getFeatureName(feature)}: ${available}`, available ? 'success' : 'warning');
            });
            
            addLog(`üìä Resumo: ${availableCount}/${totalCount} recursos dispon√≠veis`, 'info');
        };

        window.testFirebaseConfig = function() {
            addLog('üî• Testando configura√ß√£o do Firebase...', 'info');
            
            try {
                const config = configManager.getConfig();
                const securityInfo = configManager.getSecurityInfo();
                
                addLog(`‚úÖ Configura√ß√£o carregada para ambiente: ${securityInfo.environment}`, 'success');
                addLog(`üîí Fonte da configura√ß√£o: ${securityInfo.configSource}`, 'info');
                addLog(`üõ°Ô∏è N√≠vel de seguran√ßa: ${securityInfo.recommendedConfig.securityLevel}`, 'info');
                
                // Verificar se todas as chaves est√£o presentes
                const requiredKeys = ['apiKey', 'authDomain', 'projectId', 'appId'];
                const missingKeys = requiredKeys.filter(key => !config[key]);
                
                if (missingKeys.length === 0) {
                    addLog('‚úÖ Todas as chaves obrigat√≥rias est√£o presentes', 'success');
                } else {
                    addLog(`‚ö†Ô∏è Chaves faltando: ${missingKeys.join(', ')}`, 'warning');
                }
                
            } catch (error) {
                addLog(`‚ùå Erro ao testar Firebase: ${error.message}`, 'error');
            }
        };

        window.simulateProduction = function() {
            addLog('üöÄ Simulando ambiente de produ√ß√£o...', 'warning');
            
            try {
                // Usar fun√ß√£o de debug se dispon√≠vel
                if (window.configDebug && window.configDebug.simulateProduction) {
                    window.configDebug.simulateProduction();
                    
                    // Atualizar informa√ß√µes
                    setTimeout(() => {
                        environmentInfo = environmentDetector.getEnvironmentInfo();
                        updateUI();
                        addLog('‚úÖ Simula√ß√£o de produ√ß√£o ativada', 'success');
                        addLog('üí° Use "Recarregar" para restaurar o ambiente original', 'info');
                    }, 100);
                } else {
                    addLog('‚ö†Ô∏è Fun√ß√£o de simula√ß√£o n√£o dispon√≠vel', 'warning');
                }
            } catch (error) {
                addLog(`‚ùå Erro na simula√ß√£o: ${error.message}`, 'error');
            }
        };

        window.reloadEnvironment = function() {
            addLog('üîÑ Recarregando detec√ß√£o de ambiente...', 'info');
            
            try {
                // Recarregar p√°gina para restaurar estado original
                location.reload();
            } catch (error) {
                addLog(`‚ùå Erro ao recarregar: ${error.message}`, 'error');
            }
        };

        window.clearLogs = function() {
            if (logContainer) {
                logContainer.innerHTML = '<div class="log-entry log-info">Logs limpos. Sistema pronto para novos testes...</div>';
            }
        };
    </script>
</body>
</html>