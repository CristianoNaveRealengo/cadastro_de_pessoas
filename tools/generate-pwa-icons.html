<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de √çcones PWA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">
            <i class="fas fa-image mr-2 text-blue-500"></i>
            Gerador de √çcones PWA
        </h1>

        <!-- Upload de Imagem -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">1. Carregar Imagem Base</h2>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                <input type="file" id="imageInput" accept="image/*" class="hidden">
                <div id="dropZone" class="cursor-pointer">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-2">Clique para selecionar ou arraste uma imagem</p>
                    <p class="text-sm text-gray-500">Recomendado: 512x512px, PNG com fundo transparente</p>
                </div>
            </div>
        </div>

        <!-- Preview da Imagem -->
        <div id="imagePreview" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">2. Preview da Imagem</h2>
            <div class="flex items-center space-x-4">
                <canvas id="previewCanvas" class="border rounded" width="128" height="128"></canvas>
                <div>
                    <p class="font-medium" id="imageInfo"></p>
                    <p class="text-sm text-gray-600">A imagem ser√° redimensionada automaticamente</p>
                </div>
            </div>
        </div>

        <!-- Configura√ß√µes -->
        <div id="configSection" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">3. Configura√ß√µes</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cor de Fundo</label>
                    <div class="flex items-center space-x-2">
                        <input type="color" id="backgroundColor" value="#ffffff" class="w-12 h-10 border rounded">
                        <input type="text" id="backgroundColorText" value="#ffffff" class="flex-1 px-3 py-2 border rounded">
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Para √≠cones que precisam de fundo</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Padding</label>
                    <input type="range" id="padding" min="0" max="50" value="10" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>0%</span>
                        <span id="paddingValue">10%</span>
                        <span>50%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gera√ß√£o de √çcones -->
        <div id="generateSection" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">4. Gerar √çcones</h2>
            <div class="space-y-4">
                <button id="generateIcons" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium">
                    <i class="fas fa-magic mr-2"></i>
                    Gerar Todos os √çcones
                </button>
                
                <div id="progress" class="hidden">
                    <div class="bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-sm text-gray-600 mt-2">Preparando...</p>
                </div>
            </div>
        </div>

        <!-- Preview dos √çcones -->
        <div id="iconsPreview" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">5. Preview dos √çcones</h2>
            <div id="iconsGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <!-- √çcones ser√£o inseridos aqui -->
            </div>
        </div>

        <!-- Download -->
        <div id="downloadSection" class="bg-white rounded-lg shadow p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">6. Download</h2>
            <div class="space-y-4">
                <button id="downloadAll" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium">
                    <i class="fas fa-download mr-2"></i>
                    Download Todos os √çcones (ZIP)
                </button>
                
                <div class="text-sm text-gray-600">
                    <p class="mb-2"><strong>Instru√ß√µes:</strong></p>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>Extraia o arquivo ZIP</li>
                        <li>Copie os √≠cones para a pasta <code class="bg-gray-100 px-1 rounded">assets/icons/</code></li>
                        <li>Verifique se o manifest.json est√° configurado corretamente</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // Tamanhos de √≠cones necess√°rios para PWA
        const iconSizes = [
            { size: 16, name: 'icon-16x16.png', description: 'Favicon' },
            { size: 32, name: 'icon-32x32.png', description: 'Favicon' },
            { size: 72, name: 'icon-72x72.png', description: 'Android' },
            { size: 96, name: 'icon-96x96.png', description: 'Android' },
            { size: 128, name: 'icon-128x128.png', description: 'Android' },
            { size: 144, name: 'icon-144x144.png', description: 'Android' },
            { size: 152, name: 'icon-152x152.png', description: 'iOS' },
            { size: 180, name: 'icon-180x180.png', description: 'iOS' },
            { size: 192, name: 'icon-192x192.png', description: 'Android (obrigat√≥rio)' },
            { size: 384, name: 'icon-384x384.png', description: 'Android' },
            { size: 512, name: 'icon-512x512.png', description: 'Android (obrigat√≥rio)' }
        ];

        let originalImage = null;
        let generatedIcons = {};

        // Elementos DOM
        const imageInput = document.getElementById('imageInput');
        const dropZone = document.getElementById('dropZone');
        const imagePreview = document.getElementById('imagePreview');
        const previewCanvas = document.getElementById('previewCanvas');
        const imageInfo = document.getElementById('imageInfo');
        const configSection = document.getElementById('configSection');
        const generateSection = document.getElementById('generateSection');
        const backgroundColor = document.getElementById('backgroundColor');
        const backgroundColorText = document.getElementById('backgroundColorText');
        const padding = document.getElementById('padding');
        const paddingValue = document.getElementById('paddingValue');
        const generateIcons = document.getElementById('generateIcons');
        const progress = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const iconsPreview = document.getElementById('iconsPreview');
        const iconsGrid = document.getElementById('iconsGrid');
        const downloadSection = document.getElementById('downloadSection');
        const downloadAll = document.getElementById('downloadAll');

        // Event Listeners
        dropZone.addEventListener('click', () => imageInput.click());
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('drop', handleDrop);
        imageInput.addEventListener('change', handleImageSelect);
        backgroundColor.addEventListener('change', updateBackgroundColor);
        backgroundColorText.addEventListener('change', updateBackgroundColorFromText);
        padding.addEventListener('input', updatePaddingValue);
        generateIcons.addEventListener('click', generateAllIcons);
        downloadAll.addEventListener('click', downloadAllIcons);

        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('border-blue-500', 'bg-blue-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('border-blue-500', 'bg-blue-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        }

        function handleImageSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleImageFile(file);
            }
        }

        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Por favor, selecione um arquivo de imagem v√°lido.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    originalImage = img;
                    showImagePreview(img, file);
                    showConfigSection();
                    showGenerateSection();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function showImagePreview(img, file) {
            const ctx = previewCanvas.getContext('2d');
            
            // Desenhar preview
            ctx.clearRect(0, 0, 128, 128);
            ctx.drawImage(img, 0, 0, 128, 128);
            
            // Mostrar informa√ß√µes
            imageInfo.textContent = `${file.name} (${img.width}x${img.height}px)`;
            imagePreview.classList.remove('hidden');
        }

        function showConfigSection() {
            configSection.classList.remove('hidden');
        }

        function showGenerateSection() {
            generateSection.classList.remove('hidden');
        }

        function updateBackgroundColor() {
            backgroundColorText.value = backgroundColor.value;
        }

        function updateBackgroundColorFromText() {
            backgroundColor.value = backgroundColorText.value;
        }

        function updatePaddingValue() {
            paddingValue.textContent = padding.value + '%';
        }

        async function generateAllIcons() {
            if (!originalImage) {
                alert('Por favor, selecione uma imagem primeiro.');
                return;
            }

            progress.classList.remove('hidden');
            generatedIcons = {};

            for (let i = 0; i < iconSizes.length; i++) {
                const iconConfig = iconSizes[i];
                
                // Atualizar progresso
                const progressPercent = ((i + 1) / iconSizes.length) * 100;
                progressBar.style.width = progressPercent + '%';
                progressText.textContent = `Gerando ${iconConfig.name}...`;

                // Gerar √≠cone
                const iconBlob = await generateIcon(iconConfig.size);
                generatedIcons[iconConfig.name] = iconBlob;

                // Pequeno delay para mostrar progresso
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            progressText.textContent = 'Conclu√≠do!';
            showIconsPreview();
            showDownloadSection();
        }

        async function generateIcon(size) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = size;
            canvas.height = size;

            // Aplicar cor de fundo
            ctx.fillStyle = backgroundColor.value;
            ctx.fillRect(0, 0, size, size);

            // Calcular padding
            const paddingPercent = parseInt(padding.value);
            const paddingPixels = (size * paddingPercent) / 100;
            const iconSize = size - (paddingPixels * 2);

            // Desenhar imagem centralizada
            ctx.drawImage(
                originalImage,
                paddingPixels,
                paddingPixels,
                iconSize,
                iconSize
            );

            // Converter para blob
            return new Promise(resolve => {
                canvas.toBlob(resolve, 'image/png');
            });
        }

        function showIconsPreview() {
            iconsGrid.innerHTML = '';

            iconSizes.forEach(iconConfig => {
                const iconBlob = generatedIcons[iconConfig.name];
                const iconUrl = URL.createObjectURL(iconBlob);

                const iconDiv = document.createElement('div');
                iconDiv.className = 'text-center p-2 border rounded hover:bg-gray-50';
                iconDiv.innerHTML = `
                    <img src="${iconUrl}" alt="${iconConfig.name}" class="w-16 h-16 mx-auto mb-2 border rounded">
                    <div class="text-xs font-medium">${iconConfig.size}x${iconConfig.size}</div>
                    <div class="text-xs text-gray-500">${iconConfig.description}</div>
                `;

                iconsGrid.appendChild(iconDiv);
            });

            iconsPreview.classList.remove('hidden');
        }

        function showDownloadSection() {
            downloadSection.classList.remove('hidden');
        }

        async function downloadAllIcons() {
            const zip = new JSZip();
            const iconsFolder = zip.folder('icons');

            // Adicionar todos os √≠cones ao ZIP
            for (const [filename, blob] of Object.entries(generatedIcons)) {
                iconsFolder.file(filename, blob);
            }

            // Adicionar arquivo README
            const readme = `# √çcones PWA Gerados

## Instru√ß√µes de Instala√ß√£o

1. Copie todos os arquivos desta pasta para 'assets/icons/' no seu projeto
2. Verifique se o manifest.json est√° configurado corretamente
3. Teste o PWA usando Chrome DevTools > Application > Manifest

## √çcones Inclusos

${iconSizes.map(icon => `- ${icon.name} (${icon.size}x${icon.size}) - ${icon.description}`).join('\n')}

## Configura√ß√µes Usadas

- Cor de fundo: ${backgroundColor.value}
- Padding: ${padding.value}%

Gerado em: ${new Date().toLocaleString()}
`;

            zip.file('README.md', readme);

            // Gerar e baixar ZIP
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(zipBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pwa-icons.zip';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }

        // Inicializa√ß√£o
        console.log('üé® Gerador de √çcones PWA carregado');
    </script>
</body>
</html>