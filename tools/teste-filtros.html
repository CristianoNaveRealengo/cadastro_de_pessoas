<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Filtros Dinâmicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">
            <i class="fas fa-filter mr-2 text-blue-500"></i>
            Teste de Filtros Dinâmicos
        </h1>

        <!-- Controles -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Controles de Teste</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button id="addRecord2020" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    <i class="fas fa-plus mr-2"></i>
                    Registro 2020
                </button>
                <button id="addRecord2021" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    <i class="fas fa-plus mr-2"></i>
                    Registro 2021
                </button>
                <button id="addRecord2022" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    <i class="fas fa-plus mr-2"></i>
                    Registro 2022
                </button>
                <button id="clearAll" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                    <i class="fas fa-trash mr-2"></i>
                    Limpar Todos
                </button>
            </div>
        </div>

        <!-- Filtros -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Filtros Dinâmicos</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Filtro por Ano -->
                <div>
                    <label for="searchYear" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-calendar-alt mr-2 text-blue-500"></i>
                        Ano de Cadastro
                    </label>
                    <select id="searchYear" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Todos os anos</option>
                    </select>
                    <div class="mt-2 text-sm text-gray-600">
                        <strong>Anos encontrados:</strong> <span id="yearsFound">Nenhum</span>
                    </div>
                </div>

                <!-- Filtro por Encaminhamento -->
                <div>
                    <label for="searchForwarding" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-share-square mr-2 text-green-500"></i>
                        Encaminhamento
                    </label>
                    <select id="searchForwarding" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="">Todos</option>
                    </select>
                    <div class="mt-2 text-sm text-gray-600">
                        <strong>Encaminhamentos encontrados:</strong> <span id="forwardingsFound">Nenhum</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registros -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Registros Simulados</h2>
            <div id="recordsList" class="space-y-2">
                <div class="text-center text-gray-500 py-8">
                    <i class="fas fa-inbox text-4xl mb-2"></i>
                    <p>Nenhum registro encontrado</p>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Logs do Sistema</h2>
            <div id="logs" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-32 overflow-y-auto">
                Sistema de teste de filtros iniciado...<br>
            </div>
        </div>
    </div>

    <script>
        // Simulação dos dados do sistema
        const testAppData = {
            records: []
        };

        // Elementos DOM
        const searchYearEl = document.getElementById('searchYear');
        const searchForwardingEl = document.getElementById('searchForwarding');
        const yearsFoundEl = document.getElementById('yearsFound');
        const forwardingsFoundEl = document.getElementById('forwardingsFound');
        const recordsListEl = document.getElementById('recordsList');
        const logsEl = document.getElementById('logs');

        // Função para adicionar log
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            logsEl.innerHTML += `[${timestamp}] ${message}<br>`;
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        // Função para gerar registro com ano específico
        function generateRecord(year, index) {
            const encaminhamentos = [
                'Secretaria de Educação',
                'Secretaria de Saúde', 
                'Secretaria de Assistência Social',
                'Secretaria de Trabalho',
                'CRAS',
                'CREAS',
                'UBS',
                'Hospital Municipal'
            ];

            const date = new Date(year, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
            
            return {
                id: Date.now() + index,
                fullName: `Pessoa Teste ${year}-${index + 1}`,
                origin: 'MSE',
                dob: '1990-01-01',
                age: 34,
                city: 'Rio de Janeiro',
                neighborhood: 'Centro',
                education: 'Médio Completo',
                status: 'Em Análise',
                referenceName: 'Referência Teste',
                forwarding: encaminhamentos[Math.floor(Math.random() * encaminhamentos.length)],
                observation: `Registro de teste criado para o ano ${year}`,
                createdAt: date.toISOString(),
                timestamp: date.toISOString()
            };
        }

        // Função para atualizar filtros de ano
        function updateYearFilterOptions() {
            const years = new Set(
                testAppData.records.map(record => 
                    new Date(record.createdAt).getFullYear()
                )
            );

            searchYearEl.innerHTML = '<option value="">Todos os anos</option>';
            
            const sortedYears = Array.from(years).sort((a, b) => b - a);
            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year.toString();
                option.textContent = year.toString();
                searchYearEl.appendChild(option);
            });

            yearsFoundEl.textContent = sortedYears.length > 0 ? sortedYears.join(', ') : 'Nenhum';
            addLog(`Filtro de anos atualizado: ${sortedYears.length} anos encontrados`);
        }

        // Função para atualizar filtros de encaminhamento
        function updateForwardingFilterOptions() {
            const forwardings = new Set(
                testAppData.records
                    .map(record => record.forwarding)
                    .filter(f => f && f.trim() !== '')
            );

            searchForwardingEl.innerHTML = '<option value="">Todos</option>';
            
            const sortedForwardings = Array.from(forwardings).sort();
            sortedForwardings.forEach(forwarding => {
                const option = document.createElement('option');
                option.value = forwarding;
                option.textContent = forwarding;
                searchForwardingEl.appendChild(option);
            });

            forwardingsFoundEl.textContent = sortedForwardings.length > 0 ? sortedForwardings.join(', ') : 'Nenhum';
            addLog(`Filtro de encaminhamentos atualizado: ${sortedForwardings.length} opções encontradas`);
        }

        // Função para atualizar lista de registros
        function updateRecordsList() {
            if (testAppData.records.length === 0) {
                recordsListEl.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>Nenhum registro encontrado</p>
                    </div>
                `;
            } else {
                recordsListEl.innerHTML = testAppData.records.map(record => {
                    const year = new Date(record.createdAt).getFullYear();
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                            <div>
                                <div class="font-medium">${record.fullName}</div>
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-calendar mr-1"></i>${year} | 
                                    <i class="fas fa-share-square mr-1"></i>${record.forwarding}
                                </div>
                            </div>
                            <div class="text-sm text-gray-500">
                                ${record.city} - ${record.status}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Função para atualizar toda a interface
        function updateUI() {
            updateYearFilterOptions();
            updateForwardingFilterOptions();
            updateRecordsList();
        }

        // Event listeners
        document.getElementById('addRecord2020').addEventListener('click', () => {
            const record = generateRecord(2020, testAppData.records.length);
            testAppData.records.push(record);
            addLog(`Adicionado registro de 2020: ${record.fullName}`);
            updateUI();
        });

        document.getElementById('addRecord2021').addEventListener('click', () => {
            const record = generateRecord(2021, testAppData.records.length);
            testAppData.records.push(record);
            addLog(`Adicionado registro de 2021: ${record.fullName}`);
            updateUI();
        });

        document.getElementById('addRecord2022').addEventListener('click', () => {
            const record = generateRecord(2022, testAppData.records.length);
            testAppData.records.push(record);
            addLog(`Adicionado registro de 2022: ${record.fullName}`);
            updateUI();
        });

        document.getElementById('clearAll').addEventListener('click', () => {
            testAppData.records = [];
            addLog('Todos os registros foram removidos');
            updateUI();
        });

        // Listeners para os filtros
        searchYearEl.addEventListener('change', (e) => {
            const selectedYear = e.target.value;
            addLog(`Filtro de ano alterado para: ${selectedYear || 'Todos'}`);
        });

        searchForwardingEl.addEventListener('change', (e) => {
            const selectedForwarding = e.target.value;
            addLog(`Filtro de encaminhamento alterado para: ${selectedForwarding || 'Todos'}`);
        });

        // Inicialização
        updateUI();
        addLog('Sistema de teste iniciado');
        addLog('Adicione registros usando os botões acima para testar os filtros');
    </script>
</body>
</html>