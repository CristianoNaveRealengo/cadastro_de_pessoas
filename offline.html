<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline - Sistema de Cadastro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .offline-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .connection-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ef4444;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full mx-4">
        <!-- Status de Conexão -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center bg-red-100 text-red-800 px-4 py-2 rounded-full mb-4">
                <div class="connection-indicator mr-2"></div>
                <span class="text-sm font-medium">Sem conexão com a internet</span>
            </div>
        </div>

        <!-- Ícone Principal -->
        <div class="text-center mb-8">
            <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 offline-animation">
                <i class="fas fa-wifi-slash text-4xl text-blue-600"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Você está offline</h1>
            <p class="text-gray-600">Não se preocupe! O sistema continua funcionando.</p>
        </div>

        <!-- Funcionalidades Disponíveis -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                Disponível Offline
            </h2>
            <ul class="space-y-3">
                <li class="flex items-center text-gray-700">
                    <i class="fas fa-user-plus text-blue-500 mr-3 w-4"></i>
                    <span>Cadastrar novos registros</span>
                </li>
                <li class="flex items-center text-gray-700">
                    <i class="fas fa-search text-green-500 mr-3 w-4"></i>
                    <span>Buscar registros existentes</span>
                </li>
                <li class="flex items-center text-gray-700">
                    <i class="fas fa-edit text-yellow-500 mr-3 w-4"></i>
                    <span>Editar informações</span>
                </li>
                <li class="flex items-center text-gray-700">
                    <i class="fas fa-chart-bar text-purple-500 mr-3 w-4"></i>
                    <span>Ver estatísticas</span>
                </li>
                <li class="flex items-center text-gray-700">
                    <i class="fas fa-file-export text-indigo-500 mr-3 w-4"></i>
                    <span>Exportar dados</span>
                </li>
            </ul>
        </div>

        <!-- Sincronização Automática -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <i class="fas fa-sync-alt text-blue-600 mr-3 mt-1"></i>
                <div>
                    <h3 class="font-medium text-blue-800 mb-1">Sincronização Automática</h3>
                    <p class="text-sm text-blue-700">
                        Seus dados serão sincronizados automaticamente quando a conexão for restaurada.
                    </p>
                </div>
            </div>
        </div>

        <!-- Dados Locais -->
        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
            <div class="flex items-start">
                <i class="fas fa-database text-green-600 mr-3 mt-1"></i>
                <div>
                    <h3 class="font-medium text-green-800 mb-1">Dados Seguros</h3>
                    <p class="text-sm text-green-700">
                        Todos os seus dados estão salvos localmente e não serão perdidos.
                    </p>
                    <div class="mt-2">
                        <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded">
                            <span id="localRecordsCount">0</span> registros salvos
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botões de Ação -->
        <div class="space-y-3">
            <button onclick="goToSystem()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center">
                <i class="fas fa-arrow-right mr-2"></i>
                Continuar Usando o Sistema
            </button>
            
            <button onclick="checkConnection()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center">
                <i class="fas fa-refresh mr-2"></i>
                Verificar Conexão
            </button>
        </div>

        <!-- Status de Sincronização -->
        <div id="syncStatus" class="mt-6 text-center text-sm text-gray-500">
            <i class="fas fa-clock mr-1"></i>
            Aguardando conexão para sincronizar...
        </div>
    </div>

    <script>
        // Verificar dados locais
        function updateLocalDataCount() {
            try {
                const records = JSON.parse(localStorage.getItem('personalRecords') || '[]');
                document.getElementById('localRecordsCount').textContent = records.length;
            } catch (error) {
                document.getElementById('localRecordsCount').textContent = '0';
            }
        }

        // Verificar conexão
        function checkConnection() {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner animate-spin mr-2"></i>Verificando...';
            button.disabled = true;
            
            // Tentar fazer uma requisição simples
            fetch('/', { method: 'HEAD', cache: 'no-cache' })
                .then(() => {
                    // Conexão restaurada
                    showConnectionRestored();
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                })
                .catch(() => {
                    // Ainda offline
                    button.innerHTML = '<i class="fas fa-times mr-2"></i>Ainda offline';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }, 2000);
                });
        }

        // Mostrar que conexão foi restaurada
        function showConnectionRestored() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '<i class="fas fa-check-circle text-green-500 mr-1"></i>Conexão restaurada! Redirecionando...';
            statusDiv.className = 'mt-6 text-center text-sm text-green-600';
        }

        // Ir para o sistema
        function goToSystem() {
            window.location.href = '/';
        }

        // Monitorar status de conexão
        function monitorConnection() {
            window.addEventListener('online', () => {
                showConnectionRestored();
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
            });

            window.addEventListener('offline', () => {
                const statusDiv = document.getElementById('syncStatus');
                statusDiv.innerHTML = '<i class="fas fa-wifi-slash mr-1"></i>Conexão perdida novamente...';
                statusDiv.className = 'mt-6 text-center text-sm text-red-500';
            });
        }

        // Service Worker messaging
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data.type === 'BACKGROUND_SYNC') {
                    const statusDiv = document.getElementById('syncStatus');
                    statusDiv.innerHTML = '<i class="fas fa-sync-alt animate-spin mr-1"></i>' + event.data.message;
                    statusDiv.className = 'mt-6 text-center text-sm text-blue-600';
                }
            });
        }

        // Inicializar
        updateLocalDataCount();
        monitorConnection();

        // Atualizar contagem a cada 30 segundos
        setInterval(updateLocalDataCount, 30000);

        // Verificar conexão automaticamente a cada 30 segundos
        setInterval(() => {
            if (!navigator.onLine) return;
            
            fetch('/', { method: 'HEAD', cache: 'no-cache' })
                .then(() => {
                    showConnectionRestored();
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 1000);
                })
                .catch(() => {
                    // Ainda offline, não fazer nada
                });
        }, 30000);
    </script>
</body>
</html>